angular.module("angularValidator",[]),angular.module("angularValidator").directive("angularValidator",function(){return{restrict:"A",link:function(e,a,n,t){function r(e){for(var a=0;a<e.length;a++)a in e&&i(e[a])}function i(a){"validate-on"in a.attributes&&"blur"===a.attributes["validate-on"].value&&angular.element(a).on("blur",function(){o(a),f(a)});var n=e.$watch(function(){return a.value+a.required+b.submitted+s(a)+l(b[a.name])+u(b[a.name])},function(){if(b.submitted||b.$dirty)o(a),f(a);else{var e="validate-on"in a.attributes&&"dirty"===a.attributes["validate-on"].value;e?(o(a),f(a)):b[a.name]&&b[a.name].$pristine&&(o(a),f(a))}});c.push(n)}function l(e){if(e&&"$dirty"in e)return e.$dirty}function u(e){if(e&&"$valid"in e)return e.$valid}function s(a){if("validator"in a.attributes){var n=e.$eval(a.attributes.validator.value);return b[a.name].$setValidity("angularValidator",n),n}}function o(a){var n=function(){return"<i class='fa fa-times'></i> Required"},t=function(){return"<i class='fa fa-times'></i> Invalid"};if(a.name in b){var r=b[a.name],i=d(a);i&&i.remove(),(r.$dirty||e[a.form.name]&&e[a.form.name].submitted)&&(r.$error.required?"required-message"in a.attributes?angular.element(a).after(m(a.attributes["required-message"].value)):angular.element(a).after(m(n)):r.$valid||("invalid-message"in a.attributes?angular.element(a).after(m(a.attributes["invalid-message"].value)):angular.element(a).after(m(t))))}}function m(a){return"<label class='control-label has-error validationMessage'>"+e.$eval(a)+"</label>"}function d(e){for(var a=angular.element(e).parent().children(),n=0;n<a.length;n++)if(angular.element(a[n]).hasClass("validationMessage"))return angular.element(a[n]);return!1}function f(a){if(a.name in b){var n=b[a.name];angular.element(a).removeClass("has-error"),angular.element(a.parentNode).removeClass("has-error"),(n.$dirty||e[a.form.name]&&e[a.form.name].submitted)&&n.$invalid&&(angular.element(a.parentNode).addClass("has-error"),angular.element(a).addClass("has-error"))}}var v=angular.element(a)[0],c=[],g=v.attributes.name.value,b=e[g];b.submitted=!1,e.$watch(function(){return Object.keys(b).length},function(){angular.forEach(c,function(e){e()}),r(v)}),a.on("submit",function(a){a.preventDefault(),e.$apply(function(){b.submitted=!0})}),b.reset=function(){for(var e=0;e<v.length;e++)v[e].name&&(b[v[e].name].$setViewValue(""),b[v[e].name].$render());b.submitted=!1,b.$setPristine()},r(v)}}});
